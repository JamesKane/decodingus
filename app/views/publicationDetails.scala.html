@(publicationWithDetails: models.api.PublicationWithEnaStudiesAndSampleCount)

<article class="publication-details card shadow-sm mb-4">
    <div class="card-body">
        <header class="mb-3">
            <h2 class="card-title">@publicationWithDetails.publication.title</h2>
            @publicationWithDetails.publication.authors.map { authors =>
            <p class="card-subtitle text-muted"><strong>Authors:</strong>
                @authors</p>
            }.getOrElse(<p class="card-subtitle text-muted">
            <strong>Authors:</strong>
            Not available
            </p>)
        </header>

        @publicationWithDetails.publication.abstractSummary.map { summary =>
            <section class="mb-3">
                <h3 class="card-title h6">Abstract</h3>
                <p class="card-text">@summary</p>
            </section>
        }
        @if(publicationWithDetails.enaStudies.nonEmpty) {
            <section class="mb-3">
                <h3 class="card-title h6">ENA Studies</h3>
                <ul class="list-unstyled">
                @for(study <- publicationWithDetails.enaStudies) {
                    <li><code class="text-monospace">@study.accession</code> - @study.title</li>
                }
                </ul>
            </section>
        }

        @if(publicationWithDetails.sampleCount >= 0) {
            <aside class="alert alert-light mb-3" role="alert">
                <strong>Sample Count:</strong> <span class="badge bg-secondary">@publicationWithDetails.sampleCount</span>
                <div class="mt-2">
                    <button class="btn btn-outline-primary btn-sm load-biosamples"
                    hx-get="@routes.BiosampleReportController.getBiosampleReportHTML(publicationWithDetails.publication.id.get)"
                    hx-target="#biosample-collapse"
                    hx-trigger="click"
                    aria-controls="biosample-collapse"
                    aria-expanded="false">
                        Show Samples
                    </button>
                    <button class="btn btn-outline-secondary btn-sm mt-2 collapse-button"
                    data-bs-toggle="collapse"
                    data-bs-target="#biosample-collapse"
                    aria-expanded="false"
                    aria-controls="biosample-collapse"
                    style="display: none;">
                        Hide Samples
                    </button>
                    <div class="collapse mt-2" id="biosample-collapse">
                    </div>
                </div>
            </aside>
        }
        @publicationWithDetails.publication.doi.map { doi =>
            <footer class="card-footer text-muted small">
                DOI: <a href="https://doi.org/@doi" target="_blank" rel="noopener noreferrer">@doi</a>
            </footer>
        }
    </div>

    <script>
            document.addEventListener('htmx:after-swap', function(event) {
                if (event.target.id === 'biosample-collapse' && event.detail.successful) {
                    const container = event.target.parentNode; // Get the parent div
                    const hideButton = container.querySelector('.collapse-button');
                    const loadButton = container.querySelector('.load-biosamples');
                    const collapseElement = event.target;

                    if (loadButton) {
                        loadButton.textContent = 'Show Samples'; // Ensure it says "Show" initially or after hiding
                        loadButton.style.display = 'none';
                    }
                    if (hideButton) {
                        hideButton.textContent = 'Hide Samples'; // Set the correct label after loading
                        hideButton.style.display = 'inline-block';
                    }

                    // Initialize Bootstrap Collapse and show it
                    const bsCollapse = new bootstrap.Collapse(collapseElement, {
                        toggle: true
                    });
                }
            });

            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('collapse-button') && !document.getElementById('biosample-collapse').classList.contains('show')) {
                    const container = event.target.parentNode;
                    const loadButton = container.querySelector('.load-biosamples');
                    const hideButton = event.target;
                    if (loadButton) {
                        loadButton.style.display = 'inline-block';
                    }
                    if (hideButton) {
                        hideButton.style.display = 'none';
                        hideButton.textContent = 'Hide Samples'; // Reset the text if needed
                    }
                } else if (event.target.classList.contains('load-biosamples') && document.getElementById('biosample-collapse').classList.contains('show')) {
                    const container = event.target.parentNode;
                    const loadButton = event.target;
                    const hideButton = container.querySelector('.collapse-button');
                    if (loadButton) {
                        loadButton.style.display = 'inline-block'; // Show again if samples are hidden
                        loadButton.textContent = 'Show Samples';
                    }
                    if (hideButton) {
                        hideButton.style.display = 'none';
                    }
                    const bsCollapse = bootstrap.Collapse.getInstance(document.getElementById('biosample-collapse'));
                    if (bsCollapse) {
                        bsCollapse.hide();
                    }
                }
            });

    </script>
</article>