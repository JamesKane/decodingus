@import org.webjars.play.WebJarsUtil

@()(implicit request: RequestHeader, webJarsUtil: WebJarsUtil)

@main("ENA Study Search") {
    <div class="container mt-5">
        <h1>ENA Study Search</h1>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="input-group mb-3">
                    <input type="text" id="accessionInput" class="form-control"
                    placeholder="Enter ENA Study Accession (e.g., PRJEB12345)">
                    <button class="btn btn-primary" id="searchButton">Search</button>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div id="resultPanel" style="display: none">
                    <h3>Study Details</h3>
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title" id="studyTitle"></h5>
                            <h6 class="card-subtitle mb-2 text-muted" id="studyAccession"></h6>
                            <p class="card-text" id="studyCenter"></p>
                            <p class="card-text" id="studyDetails"></p>
                        </div>
                    </div>
                </div>
                <div id="errorPanel" class="alert alert-danger" style="display: none">
                </div>
            </div>
        </div>
    </div>

    <script>
            document.getElementById('searchButton').addEventListener('click', function() {
                const accession = document.getElementById('accessionInput').value.trim();
                if (!accession) {
                    showError('Please enter an accession number');
                    return;
                }

                fetch(`/api/ena/study/${accession}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Study not found');
                            }
                            return response.json();
                        })
                        .then(data => {
                            showResult(data);
                        })
                        .catch(error => {
                            showError(error.message);
                        });
            });

            function showResult(study) {
                document.getElementById('errorPanel').style.display = 'none';
                document.getElementById('resultPanel').style.display = 'block';

                document.getElementById('studyTitle').textContent = study.title;
                document.getElementById('studyAccession').textContent = study.accession;
                document.getElementById('studyCenter').textContent = `Center: ${study.centerName}`;
                document.getElementById('studyDetails').textContent = study.details;
            }

            function showError(message) {
                document.getElementById('resultPanel').style.display = 'none';
                const errorPanel = document.getElementById('errorPanel');
                errorPanel.style.display = 'block';
                errorPanel.textContent = message;
            }
    </script>
}