# Atmosphere Lexicon Overview

To support the "Atmosphere" integration within the AT Protocol (Bluesky) ecosystem, we define a specific Lexicon (schema) for Genomic Data. This allows `decodingus` to interact with the global network of Personal Data Stores (PDS) using standard XRPC methods, effectively turning genomic metadata into a portable, user-owned record type.

## Namespace

**`com.decodingus.atmosphere`**

This namespace covers the genomic operational data generated by BGS nodes and owned by Citizens.

## Status Legend

- ğŸš§ **In Development** - Currently being implemented by Navigator Workbench team
- ğŸ”® **Future Scope** - Planned for future implementation

## Design Principles

1. **Granular Records**: Each logical entity (biosample, sequence run, alignment) is a first-class record with its own AT URI. This enables fine-grained CRUD operations without cascading changes.
2. **Parent-Child References**: Child records reference their parents via AT URI, enabling relationship traversal and cascade operations.
3. **Version Tracking**: Records include metadata for change detection and conflict resolution.
4. **Soft Deletes**: Deletions are non-destructive to preserve scientific lineage.
5. **Consent-Driven Sharing**: Matching and comparison features require explicit consent records.
6. **Edge Computing / Metadata Only**: Raw genomic data (BAM, CRAM, VCF, FASTQ, genotype files) is **never** transmitted to DecodingUs. All analysis is performed locally in the Navigator Workbench. Only computed summaries and metadata flow through the PDS to the AppView.

## Sample Ownership Model

The Atmosphere system supports two ownership models:

### Citizen-Owned Samples
Citizens own their biosamples in their Personal Data Store (PDS). The lexicon records defined here live in the citizen's PDS and are indexed by the AppView via firehose subscription.

- **Source of truth**: Citizen's PDS
- **AppView role**: Index and aggregate (read-only)
- **Reconciliation**: Lives in citizen's PDS, AppView indexes the AT URI reference

### Academic/External Samples
Academic samples (from publications, research projects) are owned and managed by the AppView administration. There is no citizen PDS - the AppView IS the source of truth.

- **Source of truth**: AppView database
- **AppView role**: Create, manage, and serve data
- **Reconciliation**: Generated and stored by AppView

### Specimen Donor as Shared Entity
The `specimen_donor` concept exists at the AppView level to unify samples from the same individual across both ownership models. A donor may have:
- Multiple citizen-owned biosamples (from different PDS accounts or test kits)
- Multiple academic samples (from different publications)
- A mix of both

Reconciliation references are stored at the specimen donor level, not the biosample level, since a donor may have multiple biosamples from different testing companies or labs that need to be reconciled together.

## Data Flow: What Flows vs What Stays Local

### What Flows to DecodingUs (via PDS)

| Data Type | Purpose | Example Fields |
|:---|:---|:---|
| Haplogroup assignments | Tree placement & refinement | `haplogroupName`, `score`, `lineagePath` |
| Private Y-DNA/mtDNA SNPs | Branch discovery consensus | `privateVariants` array |
| STR marker values | Ancestral reconstruction & TMRCA | `strProfile.markers` |
| Coverage/quality metrics | Sample characterization | `alignmentMetrics` summary |
| Ancestry percentages | Population context & IBD match introductions | `populationBreakdown.components` (33 sub-continental populations), `superPopulationSummary` (9 continental groups), `pcaCoordinates` |
| File metadata | Provenance tracking | `fileInfo` (name, checksum, size - NOT content) |

### What NEVER Flows to DecodingUs

| Data Type | Stays Where | Notes |
|:---|:---|:---|
| BAM/CRAM files | Local workbench | Aligned sequences |
| VCF files | Local workbench | Only private SNPs shared, not full VCF |
| FASTQ files | Local workbench | Raw reads |
| Genotype chip files | Local workbench | Ancestry computed locally |
| IBD segments | Local workbench | Only confirmed match metadata shared |

**Note on `fileInfo` records**: The `location` field in `fileInfo` is for the user's own reference (local paths, personal cloud storage). DecodingUs does NOT access these locations. The field exists so users can track where their files are stored for their own analysis workflows.

## Document Index

| Document                                                     | Contents | Status |
|:-------------------------------------------------------------|:---|:---|
| [01-Common-Definitions.md](./01-Common-Definitions.md)       | Shared type definitions (`recordMeta`, `fileInfo`, `haplogroupResult`, `variantCall`, `reconciliationStatus`, etc.) | Core |
| [02-Core-Records.md](./02-Core-Records.md)                   | `workspace`, `biosample`, `sequencerun`, `alignment`, `project` | Core |
| [03-Genotype-Records.md](./03-Genotype-Records.md)           | `genotype`, `imputation` | ğŸš§ In Development |
| [04-Ancestry-Records.md](./04-Ancestry-Records.md)           | `populationBreakdown` | ğŸš§ In Development |
| [05-STR-Records.md](./05-STR-Records.md)                     | `strProfile`, `haplogroupAncestralStr` | ğŸ”® Future |
| [06-IBD-Matching-Records.md](./06-IBD-Matching-Records.md)   | `matchConsent`, `matchList`, `matchRequest` | ğŸ”® Future |
| [07-Discovery-Records.md](./07-Discovery-Records.md)         | `instrumentObservation` | ğŸ”® Future |
| [08-AppView-Lifecycle.md](./08-AppView-Lifecycle.md)         | Firehose event handling, schema requirements, conflict resolution | Reference |
| [09-Reconciliation-Records.md](09-Reconciliation-Records.md) | `haplogroupReconciliation` for multi-run consensus | Core |
| [10-Examples.md](10-Examples.md)                             | Mock data and CRUD flow examples | Reference |

## Record Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 WORKSPACE                                        â”‚
â”‚  at://did:plc:user/com.decodingus.atmosphere.workspace/tid                      â”‚
â”‚                                                                                  â”‚
â”‚  sampleRefs: [...]  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  projectRefs: [...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             BIOSAMPLE               â”‚  â”‚              PROJECT                â”‚
â”‚  at://did/collection/tid            â”‚  â”‚  at://did/collection/tid            â”‚
â”‚                                     â”‚  â”‚                                     â”‚
â”‚  haplogroups: { yDna, mtDna }       â”‚  â”‚  projectName, administrator         â”‚
â”‚  sequenceRunRefs: [...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚  memberRefs: [...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  genotypeRefs: [...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚                                     â”‚
â”‚  populationBreakdownRef â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚                                     â”‚
â”‚  strProfileRef â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚         â”‚         â”‚
          â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         â”‚                                           â–¼
          â”‚         â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         â”‚                            â”‚     POPULATION BREAKDOWN        â”‚
          â”‚         â”‚                            â”‚  ancestry components [...]      â”‚
          â”‚         â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚         â”‚
          â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                                     â–¼
          â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                      â”‚           GENOTYPE              â”‚
          â”‚                                      â”‚  testTypeCode, provider         â”‚
          â”‚                                      â”‚  files: [...]                   â”‚
          â”‚                                      â”‚  imputationRef â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
          â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â–¼                                                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SEQUENCE RUN            â”‚                           â”‚          IMPUTATION             â”‚
â”‚  platformName, instrumentId     â”‚                           â”‚  referencePanel, imputedCount   â”‚
â”‚  files: [...]                   â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  alignmentRefs: [...] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â”‚                           â–¼
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         â”‚           ALIGNMENT             â”‚
          â”‚         â”‚  referenceBuild, aligner        â”‚
          â”‚         â”‚  files: [...], metrics: {...}   â”‚
          â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    INSTRUMENT OBSERVATION       â”‚
                         â”‚  instrumentId, labName          â”‚
                         â”‚  confidence: KNOWN|INFERRED     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              STR SUBSYSTEM                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  BIOSAMPLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º STR PROFILE                                              â”‚
â”‚                         markers: [{ marker, value }]                             â”‚
â”‚                         panels: [Y37, Y111, ...]                                â”‚
â”‚                                                                                  â”‚
â”‚  HAPLOGROUP NODE â”€â”€â”€â”€â–º ANCESTRAL STR                                            â”‚
â”‚                         ancestralMarkers: [{ marker, value, confidence }]       â”‚
â”‚                         branchMutations: [{ from, to }]                         â”‚
â”‚                         tmrcaEstimate: { ybp, confidence }                      â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RECONCILIATION SUBSYSTEM                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Note: Reconciliation is at the SPECIMEN DONOR level (AppView concept),         â”‚
â”‚  not biosample level, since a donor may have multiple biosamples/runs.          â”‚
â”‚                                                                                  â”‚
â”‚  SPECIMEN DONOR â”€â”€â”€â”€â”€â–º HAPLOGROUP RECONCILIATION (Y-DNA)                        â”‚
â”‚                 â”€â”€â”€â”€â”€â–º HAPLOGROUP RECONCILIATION (MT-DNA)                        â”‚
â”‚                                                                                  â”‚
â”‚  RECONCILIATION â”€â”€â”€â”€â”€â–º status: { compatibilityLevel, consensusHaplogroup,       â”‚
â”‚                                  branchCompatibilityScore, snpConcordance }     â”‚
â”‚                  â”€â”€â”€â”€â”€â–º runCalls: [{ runRef, haplogroup, confidence, tech }]    â”‚
â”‚                  â”€â”€â”€â”€â”€â–º snpConflicts: [{ position, snpName, calls, resolution }]â”‚
â”‚                  â”€â”€â”€â”€â”€â–º heteroplasmyObservations: [{ pos, majorAllele, VAF }]   â”‚
â”‚                  â”€â”€â”€â”€â”€â–º identityVerification: { kinship, fingerprint, yStr }    â”‚
â”‚                  â”€â”€â”€â”€â”€â–º auditLog: [{ timestamp, action, consensus changes }]    â”‚
â”‚                                                                                  â”‚
â”‚  Compatibility Levels:                                                          â”‚
â”‚    COMPATIBLE        - Same branch, different depths (Run A: R-BY18291,         â”‚
â”‚                        Run B: R-CTS4466 - both valid, accept deepest)           â”‚
â”‚    MINOR_DIVERGENCE  - Tip-level differences, sibling terminal branches         â”‚
â”‚    MAJOR_DIVERGENCE  - Branch-level split (e.g., R-DF13 children diverge)       â”‚
â”‚    INCOMPATIBLE      - Different individuals (R1b vs I2a)                       â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            MATCHING SUBSYSTEM                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  BIOSAMPLE â—„â”€â”€â”€â”€â”€ MATCH CONSENT                                                 â”‚
â”‚      â”‚              (enables matching)                                           â”‚
â”‚      â”‚                                                                          â”‚
â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º MATCH LIST                                                   â”‚
â”‚      â”‚              matches: [{ biosampleRef, sharedCm, segments }]             â”‚
â”‚      â”‚                                                                          â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º MATCH REQUEST â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                     (from â†’ to, status: PENDING|ACCEPTED)                  â”‚    â”‚
â”‚                                                    â”‚                       â”‚    â”‚
â”‚                                                    â””â”€â”€â”€â–º OTHER BIOSAMPLE â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Strategy

In the "Atmosphere" model, this Lexicon defines the data structures for decentralized, user-owned genomic records:

1. **MVP (Current):** The BGS Node (Rust) constructs a JSON payload matching the `ExternalBiosampleRequest` (a simplified subset of this Lexicon) and pushes it to `decodingus` via REST.
2. **Phase 2 (Hybrid - Kafka):** The BGS Node uses this Lexicon structure (or a derived internal representation) to send messages to Kafka. `decodingus` consumes from Kafka and processes a compatible subset.
3. **Phase 3 (Full Atmosphere - AppView):**
    * The Researcher's Edge App (Java) or the BGS Node (authorized by the user) constructs records fully compliant with this Lexicon.
    * These records are written directly to the User's PDS.
    * `decodingus` (acting as an AppView) subscribes to the ATP Firehose, ingesting these records and indexing them.

## Record Status Summary

| Record Type | Status | Planning Document | Purpose |
|:---|:---|:---|:---|
| `biosample` | Core | - | Sample and donor metadata |
| `sequencerun` | Core | - | Sequencing run metadata |
| `alignment` | Core | - | Alignment metrics |
| `project` | Core | - | Research project grouping |
| `workspace` | Core | - | User workspace container |
| `haplogroupReconciliation` | Core | MultiRunReconciliation.md | Multi-run haplogroup reconciliation |
| `genotype` | ğŸš§ In Development | multi-test-type-roadmap.md | Chip/array data support |
| `populationBreakdown` | ğŸš§ In Development | AncestryAnalysis.md | Ancestry composition |
| `imputation` | ğŸ”® Future | multi-test-type-roadmap.md | Imputed genotype results |
| `matchConsent` | ğŸ”® Future | ibd-matching-system.md | IBD matching opt-in |
| `matchList` | ğŸ”® Future | ibd-matching-system.md | IBD match results |
| `matchRequest` | ğŸ”® Future | ibd-matching-system.md | Match contact requests |
| `instrumentObservation` | ğŸ”® Future | sequencer-lab-inference-system.md | Crowdsourced lab discovery |
| `strProfile` | ğŸ”® Future | Y-DNA STR Support | Individual Y-STR marker data |
| `haplogroupAncestralStr` | ğŸ”® Future | Y-DNA Tree Enhancement | Reconstructed ancestral STR states |

## Changelog

| Version | Date | Changes |
|:---|:---|:---|
| 1.0 | 2025-12-05 | Initial design with CRUD-optimized record structure |
| 1.1 | 2025-12-06 | Added future scope records from planning documents |
| 1.2 | 2025-12-07 | Added STR profile and ancestral STR reconstruction records |
| 1.3 | 2025-12-07 | Added backfeed record types for AppView-to-PDS updates |
| 1.4 | 2025-12-07 | Edge computing compliance: Clarified all `files` fields store metadata only |
| 1.5 | 2025-12-08 | Added multi-run reconciliation support, enhanced ancestry analysis with 33 populations |
| 1.6 | 2025-12-08 | Multi-test-type support with taxonomy codes, enhanced genotype record |
| 1.7 | 2025-12-09 | Split into multiple focused documents, added status indicators |
