@import models.domain.genomics.VariantGroup
@(haplogroupId: Int, variantGroups: Seq[VariantGroup])(implicit request: RequestHeader)

<h6 class="d-flex justify-content-between align-items-center">
    <span><i class="bi bi-code-square"></i> Defining Variants</span>
    <button type="button"
            class="btn btn-outline-primary btn-sm"
            data-bs-toggle="modal"
            data-bs-target="#variantSearchModal"
            hx-get="@controllers.routes.CuratorController.searchVariantsForHaplogroup(haplogroupId, None)"
            hx-target="#variant-search-content"
            hx-trigger="click">
        <i class="bi bi-plus"></i> Add
    </button>
</h6>

@if(variantGroups.isEmpty) {
    <p class="text-muted small">No variants associated with this haplogroup.</p>
} else {
    <ul class="list-group list-group-flush small">
        @for(group <- variantGroups) {
            <li class="list-group-item px-0">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <strong>@group.displayName</strong>
                        @group.rsId.filter(_ != group.displayName).map { rs =>
                            <span class="text-muted ms-1">(@rs)</span>
                        }
                        <span class="badge bg-secondary ms-1">@group.buildCount build@if(group.buildCount != 1){s}</span>
                    </div>
                    <button type="button"
                            class="btn btn-outline-danger btn-sm"
                            hx-delete="@controllers.routes.CuratorController.removeVariantGroupFromHaplogroup(haplogroupId, group.groupKey)"
                            hx-target="#variants-panel"
                            hx-confirm="Remove all @group.buildCount build(s) of @group.displayName from this haplogroup?">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
                <div class="mt-1 ps-2">
                    @for(vwc <- group.variantsSorted) {
                        <div class="text-muted small">
                            <span class="badge bg-info me-1" style="min-width: 55px;">@vwc.shortReferenceGenome</span>
                            <code>@vwc.formattedPosition</code>
                            <span class="ms-1">@vwc.variant.referenceAllele&rarr;@vwc.variant.alternateAllele</span>
                        </div>
                    }
                </div>
            </li>
        }
    </ul>
}

<!-- Modal for variant search -->
<div class="modal fade" id="variantSearchModal" tabindex="-1" aria-labelledby="variantSearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="variantSearchModalLabel">Add Variant</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="variant-search-content">
                <!-- Content loaded via HTMX -->
                <div class="text-center py-3">
                    <div class="spinner-border spinner-border-sm" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
