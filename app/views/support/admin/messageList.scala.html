@import org.webjars.play.WebJarsUtil
@import models.domain.support.{ContactMessage, MessageStatus}
@import utils.CuratorViewUtils
@(messages: Seq[ContactMessage], statusFilter: Option[MessageStatus], currentPage: Int, totalPages: Int, pageSize: Int)(implicit request: RequestHeader, messagesProvider: Messages, webJarsUtil: WebJarsUtil)

@main(messagesProvider("support.admin.title")) {
    <div class="container py-5">
        <h1 class="mb-4">@messagesProvider("support.admin.heading")</h1>

        @views.html.fragments.flashMessages(request.flash)

        <div class="card mb-4">
            <div class="card-body">
                <form method="get" action="@controllers.routes.SupportAdminController.listMessages()" class="row g-3">
                    <div class="col-auto">
                        <label class="col-form-label">@messagesProvider("support.admin.filterStatus")</label>
                    </div>
                    <div class="col-auto">
                        <select name="status" class="form-select" onchange="this.form.submit()">
                            <option value="">@messagesProvider("support.admin.allStatuses")</option>
                            @for(status <- Seq(MessageStatus.New, MessageStatus.Read, MessageStatus.Replied, MessageStatus.Closed)) {
                                <option value="@status.value" @if(statusFilter.contains(status)) {selected}>
                                    @messagesProvider(s"support.status.${status.value}")
                                </option>
                            }
                        </select>
                    </div>
                </form>
            </div>
        </div>

        @if(messages.isEmpty) {
            <div class="alert alert-info">@messagesProvider("support.admin.noMessages")</div>
        } else {
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>@messagesProvider("support.admin.table.status")</th>
                            <th>@messagesProvider("support.admin.table.from")</th>
                            <th>@messagesProvider("support.admin.table.subject")</th>
                            <th>@messagesProvider("support.admin.table.date")</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for(msg <- messages) {
                            <tr class="@if(msg.status == MessageStatus.New) {table-primary}">
                                <td>
                                    <span class="badge @CuratorViewUtils.statusBadgeClass(msg.status)">
                                        @messagesProvider(s"support.status.${msg.status.value}")
                                    </span>
                                </td>
                                <td>
                                    @if(msg.userId.isDefined) {
                                        <span class="badge bg-info me-1">@messagesProvider("support.admin.authenticated")</span>
                                    }
                                    @msg.senderName.orElse(msg.userId.map(_ => messagesProvider("support.admin.registeredUser"))).getOrElse("Unknown")
                                </td>
                                <td>@msg.subject</td>
                                <td>@msg.createdAt.toLocalDate</td>
                                <td>
                                    <a href="@controllers.routes.SupportAdminController.viewMessage(msg.id.get)" class="btn btn-sm btn-outline-primary">
                                        @messagesProvider("support.admin.view")
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @views.html.fragments.htmlPagination(
                currentPage = currentPage,
                totalPages = totalPages,
                pageSize = pageSize,
                linkGenerator = (p, ps) => controllers.routes.SupportAdminController.listMessages(statusFilter.map(_.value), p, ps)
            )
        }
    </div>
}
