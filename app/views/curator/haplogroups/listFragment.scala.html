@import models.domain.haplogroups.Haplogroup
@(haplogroups: Seq[Haplogroup], query: Option[String], hgType: Option[String], currentPage: Int, totalPages: Int, pageSize: Int)(implicit request: RequestHeader, messages: Messages)

@if(haplogroups.isEmpty) {
    <div class="alert alert-info">No haplogroups found matching your criteria.</div>
} else {
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Source</th>
                    <th>Provenance</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @for(hg <- haplogroups) {
                    <tr class="cursor-pointer"
                        hx-get="@controllers.routes.CuratorController.haplogroupDetailPanel(hg.id.get)"
                        hx-target="#detail-panel"
                        hx-swap="innerHTML"
                        style="cursor: pointer;">
                        <td><strong>@hg.name</strong></td>
                        <td>
                            @views.html.fragments.badges.haplogroupType(hg.haplogroupType.toString)
                        </td>
                        <td>@hg.source</td>
                        <td>
                            @hg.provenance.map { prov =>
                                @views.html.fragments.badges.provenance(
                                    prov.primaryCredit,
                                    if(prov.nodeProvenance.size > 1) prov.nodeProvenance.size - 1 else 0,
                                    Some(s"Primary: ${prov.primaryCredit}, Contributors: ${prov.nodeProvenance.mkString(", ")}")
                                )
                            }.getOrElse {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            <a href="@controllers.routes.CuratorController.editHaplogroupForm(hg.id.get)"
                               class="btn btn-sm btn-outline-secondary"
                               onclick="event.stopPropagation()">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @views.html.fragments.pagination(
        currentPage,
        totalPages,
        (p: Int) => controllers.routes.CuratorController.haplogroupsFragment(query, hgType, p, pageSize),
        "#haplogroups-table",
        "#haplogroup-search, #type-filter"
    )
}
