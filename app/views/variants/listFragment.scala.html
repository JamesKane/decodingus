@import models.domain.genomics.VariantV2
@import utils.VariantViewUtils
@(variants: Seq[VariantV2], query: Option[String], currentPage: Int, totalPages: Int, pageSize: Int, totalCount: Int)(implicit request: RequestHeader, messages: Messages)

@defining(java.text.NumberFormat.getIntegerInstance()) { nf =>
<div class="d-flex justify-content-between align-items-center mb-2">
    <small class="text-muted">
        @if(query.exists(_.trim.nonEmpty)) {
            @messages("variants.browser.foundMatching", nf.format(totalCount), query.get)
        } else {
            @messages("variants.browser.showingTotal", nf.format(totalCount))
        }
    </small>
    @if(totalPages > 1) {
        <small class="text-muted">@messages("variants.browser.pageOf", currentPage, nf.format(totalPages))</small>
    }
</div>
}

@if(variants.isEmpty) {
    <div class="alert alert-info">
        @if(query.exists(_.trim.nonEmpty)) {
            @messages("variants.browser.noResults", query.get)
        } else {
            @messages("variants.browser.enterSearch")
        }
    </div>
} else {
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>@messages("variants.browser.col.name")</th>
                    <th>@messages("variants.browser.col.alleles")</th>
                    <th>@messages("variants.browser.col.type")</th>
                    <th>@messages("variants.browser.col.builds")</th>
                </tr>
            </thead>
            <tbody>
                @for(variant <- variants) {
                    @defining(VariantViewUtils.primaryAlleles(variant)) { alleles =>
                        @defining(VariantViewUtils.refGenomes(variant)) { refs =>
                            <tr class="cursor-pointer"
                                hx-get="@controllers.routes.VariantBrowserController.detailPanel(variant.variantId.get)"
                                hx-target="#detail-panel"
                                hx-swap="innerHTML"
                                style="cursor: pointer;">
                                <td>
                                    <strong>@variant.displayName</strong>
                                    @variant.rsIds.headOption.filter(_ != variant.canonicalName.getOrElse("")).map { rsId =>
                                        <br><small class="text-muted">@rsId</small>
                                    }
                                </td>
                                <td>
                                    <code>@alleles._1</code><i class="bi bi-arrow-right text-muted mx-1" style="font-size: 0.6rem;"></i><code>@alleles._2</code>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">@variant.mutationType.displayName</span>
                                </td>
                                <td>
                                    @for(refGenome <- refs) {
                                        <span class="badge @VariantViewUtils.buildBadgeClass(refGenome)" title="@refGenome">
                                            @VariantViewUtils.shortRefGenome(refGenome)
                                        </span>
                                    }
                                </td>
                            </tr>
                        }
                    }
                }
            </tbody>
        </table>
    </div>

    @views.html.fragments.pagination(
        currentPage,
        totalPages,
        p => controllers.routes.VariantBrowserController.listFragment(query, p, pageSize),
        "#variants-table",
        "#variant-search"
    )
}