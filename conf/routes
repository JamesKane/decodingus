# Routes
# This file defines all application routes (Higher priority routes first)
# https://www.playframework.com/documentation/latest/ScalaRouting
# ~~~~

# Health check for load balancers and container orchestration
GET           /health                                                                            controllers.HomeController.health()

GET           /                                                                                  controllers.HomeController.index()
GET           /cookie-usage                                                                      controllers.HomeController.cookieUsage()
GET           /terms                                                                             controllers.HomeController.terms()
GET           /privacy                                                                           controllers.HomeController.privacy()
GET           /faq                                                                               controllers.HomeController.faq()
GET           /reputation                                                                        controllers.HomeController.reputation()

GET           /sitemap.xml                                                                       controllers.HomeController.sitemap()
GET           /robots.txt                                                                        controllers.HomeController.robots()

GET           /ytree                                                                             controllers.TreeController.ytree(rootHaplogroup: Option[String])
GET           /mtree                                                                             controllers.TreeController.mtree(rootHaplogroup: Option[String])
GET           /ytree/fragment                                                                    controllers.TreeController.yTreeFragment(rootHaplogroup: Option[String])
GET           /mtree/fragment                                                                    controllers.TreeController.mTreeFragment(rootHaplogroup: Option[String])

GET           /haplogroups/snp-sidebar/placeholder                                               controllers.TreeController.emptySnpDetailSidebarPlaceholder
GET           /haplogroups/snp-sidebar/:haplogroupName                                           controllers.TreeController.getSnpDetailSidebar(haplogroupName: String, haplogroupType: models.HaplogroupType)


GET           /references                                                                        controllers.PublicationController.index()
GET           /references/details                                                                controllers.PublicationController.getAllPublicationsWithDetailsHtml(page: Option[Int], pageSize: Option[Int], query: Option[String])
GET           /references/details/:publicationId/biosamples                                      controllers.BiosampleReportController.getBiosampleReportHTML(publicationId: Int, page: Option[Int] ?= Some(1))

GET           /publications/submit                                                               controllers.PublicationController.showSubmissionForm()
POST          /publications/submit                                                               controllers.PublicationController.submitPaper()

GET           /coverage-benchmarks                                                               controllers.CoverageController.index()

# Variant Browser (public read-only)
GET           /variants                                                                          controllers.VariantBrowserController.index(query: Option[String] ?= None, page: Int ?= 1, pageSize: Int ?= 25)
GET           /variants/list                                                                     controllers.VariantBrowserController.listFragment(query: Option[String] ?= None, page: Int ?= 1, pageSize: Int ?= 25)
GET           /variants/detail/:id                                                               controllers.VariantBrowserController.detailPanel(id: Int)

# Contact form routes
GET           /contact                                                                           controllers.ContactController.show()
POST          /contact                                                                           controllers.ContactController.submit()
GET           /my-messages                                                                       controllers.ContactController.myMessages()
GET           /my-messages/badge                                                                 controllers.ContactController.userMessageBadge()

# Support Admin (requires Admin role)
GET           /admin/messages                                                                    controllers.SupportAdminController.listMessages(status: Option[String] ?= None, page: Int ?= 1, pageSize: Int ?= 20)
GET           /admin/messages/badge                                                              controllers.SupportAdminController.adminMessageBadge()
GET           /admin/messages/:id                                                                controllers.SupportAdminController.viewMessage(id: java.util.UUID)
POST          /admin/messages/:id/reply                                                          controllers.SupportAdminController.submitReply(id: java.util.UUID)
GET           /admin/messages/:id/status/:status                                                 controllers.SupportAdminController.updateStatus(id: java.util.UUID, status: String)

GET           /api/v1/y-tree                                                                     controllers.TreeController.apiYTree(rootHaplogroup: Option[String])
GET           /api/v1/mt-tree                                                                    controllers.TreeController.apiMTree(rootHaplogroup: Option[String])

# Coverage API
GET           /api/v1/coverage/benchmarks                                                        controllers.CoverageController.apiBenchmarks()
GET           /coverage/labs                                                                     controllers.CoverageController.labs
GET           /coverage/benchmarks/lab/:labId                                                    controllers.CoverageController.benchmarksByLabWithDetails(labId: Int)

# Sequencer API
GET           /api/v1/sequencer/lab                                                              controllers.SequencerController.getLabByInstrumentId(instrument_id: String)
GET           /api/v1/sequencer/lab-instruments                                                  controllers.SequencerController.getAllLabInstruments
POST          /api/v1/sequencer/lab/associate                                                    controllers.SequencerController.associateLabWithInstrument()

GET           /api/v1/references/details                                                         controllers.PublicationController.getAllPublicationsWithDetailsJson()
GET           /api/v1/references/details/:publicationId/biosamples                               controllers.BiosampleReportController.getBiosampleReportJSON(publicationId: Int)

GET           /biosamples/map                                                                    controllers.BiosampleMapController.mapView()
GET           /biosamples/geo-data                                                               controllers.BiosampleMapController.geoData()

# Sample studies endpoint
GET           /api/v1/biosample/studies                                                          controllers.BiosampleController.getSamplesWithStudies()

# Biosample API endpoint
PATCH         /api/private/biosamples/:id                                                        controllers.BiosampleController.updateBiosample(id: Int)
GET           /api/private/biosamples/search                                                     controllers.BiosampleController.findByAliasOrAccession(query: String)

POST          /api/private/biosamples/publication-link                                           controllers.BiosamplePublicationController.linkBiosampleToPublication

# Biosample Original Haplogroup endpoints
PUT           /api/private/biosamples/:biosampleId/publications/:publicationId/haplogroup        controllers.BiosampleOriginalHaplogroupController.updateOrCreateHaplogroup(biosampleId: Int, publicationId: Int)
GET           /api/private/biosamples/:biosampleId/publications/:publicationId/haplogroup        controllers.BiosampleOriginalHaplogroupController.getHaplogroup(biosampleId: Int, publicationId: Int)
DELETE        /api/private/biosamples/:biosampleId/publications/:publicationId/haplogroup        controllers.BiosampleOriginalHaplogroupController.deleteHaplogroup(biosampleId: Int, publicationId: Int)


# PGP Biosample API endpoints
POST          /api/private/pgp/biosamples                                                        controllers.PgpBiosampleController.create
POST          /api/private/pgp/biosamples/:sampleGuid/sequences                                  controllers.BiosampleDataController.addSequenceData(sampleGuid: java.util.UUID)
POST          /api/private/pgp/biosamples/:sampleGuid/publication                                controllers.BiosampleDataController.linkPublication(sampleGuid: java.util.UUID)

# External Biosample API endpoints
POST          /api/private/external/biosamples                                                   controllers.ExternalBiosampleController.create
POST          /api/private/external/biosamples/:sampleGuid/sequences                             controllers.BiosampleDataController.addSequenceData(sampleGuid: java.util.UUID)
POST          /api/private/external/biosamples/:sampleGuid/publication                           controllers.BiosampleDataController.linkPublication(sampleGuid: java.util.UUID)

# Specimen Donor endpoints
POST          /api/private/donors/merge                                                          controllers.SpecimenDonorController.mergeDonors()

# Sequencing Lab private admin CRUD (not exposed in Swagger)
GET           /api/private/sequencing-labs                                                       controllers.SequencingLabAdminController.list
GET           /api/private/sequencing-labs/:id                                                   controllers.SequencingLabAdminController.get(id: Int)
POST          /api/private/sequencing-labs                                                       controllers.SequencingLabAdminController.create
PATCH         /api/private/sequencing-labs/:id                                                   controllers.SequencingLabAdminController.update(id: Int)
DELETE        /api/private/sequencing-labs/:id                                                   controllers.SequencingLabAdminController.delete(id: Int)

# Atmosphere Firehose
POST          /api/firehose/event                                                                controllers.FirehoseController.processEvent

# Publication Discovery
POST          /api/private/publication-discovery/run                                             controllers.PublicationDiscoveryController.triggerDiscovery()

# Genomics Admin
GET           /admin/genomics                                                                    controllers.GenomicsAdminController.dashboard()
+nocsrf
POST          /api/private/genomics/ybrowse/update                                               controllers.GenomicsAdminController.triggerYBrowseUpdate()

# Private Variant API (unlisted, X-API-Key secured)
POST          /api/private/variants/builds                                                       controllers.VariantApiController.bulkAddBuilds()
POST          /api/private/variants/rsids                                                        controllers.VariantApiController.bulkUpdateRsIds()

# Private Alias Source Management API (X-API-Key secured)
GET           /api/private/aliases/sources/stats                                                 controllers.VariantApiController.getAliasSourceStats()
GET           /api/private/aliases/sources/preview                                               controllers.VariantApiController.previewAliasSourceUpdate(aliasPrefix: String, currentSource: String)
POST          /api/private/aliases/sources                                                       controllers.VariantApiController.bulkUpdateAliasSources()

# Authentication
GET           /login                                                                             controllers.AuthController.login
POST          /login                                                                             controllers.AuthController.authenticate
POST          /logout                                                                            controllers.AuthController.logout
GET           /app-password-help                                                                 controllers.AuthController.showAppPasswordHelp()

# Cookie Consent (GDPR)
GET           /cookies/check                                                                     controllers.CookieConsentController.checkConsent
POST          /cookies/accept                                                                    controllers.CookieConsentController.acceptConsent

# User Profile
GET           /profile                                                                           controllers.ProfileController.view
POST          /profile                                                                           controllers.ProfileController.update

# Variant API (legacy)
GET           /api/v1/variants/search                                                            controllers.VariantController.search(name: String)

# Public Variant API
GET           /api/v1/variants                                                                   controllers.VariantPublicApiController.searchVariants(query: Option[String] ?= None, page: Int ?= 1, pageSize: Int ?= 25)
GET           /api/v1/variants/export                                                            controllers.VariantPublicApiController.downloadExport()
GET           /api/v1/variants/export/metadata                                                   controllers.VariantPublicApiController.exportMetadata()
GET           /api/v1/variants/:variantId                                                        controllers.VariantPublicApiController.getVariantById(variantId: Int)
GET           /api/v1/haplogroups/:haplogroupName/variants                                       controllers.VariantPublicApiController.getVariantsByHaplogroup(haplogroupName: String)

# Private Variant Export API (X-API-Key secured)
POST          /api/private/variants/export/generate                                              controllers.VariantPublicApiController.triggerExport()

# Genome Regions API
GET           /api/v1/genome-regions                                                             controllers.GenomeRegionsApiController.listBuilds()
GET           /api/v1/genome-regions/:build                                                      controllers.GenomeRegionsApiController.getRegions(build: String)

# =============================================
# Genome Regions API Management (X-API-Key secured)
# =============================================
# Genome Regions
GET           /api/v1/manage/genome-regions                                                      controllers.GenomeRegionsApiManagementController.listRegions(build: Option[String])
GET           /api/v1/manage/genome-regions/:id                                                  controllers.GenomeRegionsApiManagementController.getRegion(id: Int)
POST          /api/v1/manage/genome-regions                                                      controllers.GenomeRegionsApiManagementController.createRegion()
PUT           /api/v1/manage/genome-regions/:id                                                  controllers.GenomeRegionsApiManagementController.updateRegion(id: Int)
DELETE        /api/v1/manage/genome-regions/:id                                                  controllers.GenomeRegionsApiManagementController.deleteRegion(id: Int)
POST          /api/v1/manage/genome-regions/bulk                                                 controllers.GenomeRegionsApiManagementController.bulkCreateRegions()

# Cytobands
GET           /api/v1/manage/cytobands                                                           controllers.GenomeRegionsApiManagementController.listCytobands(build: Option[String])
GET           /api/v1/manage/cytobands/:id                                                       controllers.GenomeRegionsApiManagementController.getCytoband(id: Int)
POST          /api/v1/manage/cytobands                                                           controllers.GenomeRegionsApiManagementController.createCytoband()
PUT           /api/v1/manage/cytobands/:id                                                       controllers.GenomeRegionsApiManagementController.updateCytoband(id: Int)
DELETE        /api/v1/manage/cytobands/:id                                                       controllers.GenomeRegionsApiManagementController.deleteCytoband(id: Int)
POST          /api/v1/manage/cytobands/bulk                                                      controllers.GenomeRegionsApiManagementController.bulkCreateCytobands()

# STR Markers
GET           /api/v1/manage/str-markers                                                         controllers.GenomeRegionsApiManagementController.listStrMarkers(build: Option[String])
GET           /api/v1/manage/str-markers/:id                                                     controllers.GenomeRegionsApiManagementController.getStrMarker(id: Int)
POST          /api/v1/manage/str-markers                                                         controllers.GenomeRegionsApiManagementController.createStrMarker()
PUT           /api/v1/manage/str-markers/:id                                                     controllers.GenomeRegionsApiManagementController.updateStrMarker(id: Int)
DELETE        /api/v1/manage/str-markers/:id                                                     controllers.GenomeRegionsApiManagementController.deleteStrMarker(id: Int)
POST          /api/v1/manage/str-markers/bulk                                                    controllers.GenomeRegionsApiManagementController.bulkCreateStrMarkers()

# Curator Workflow
GET           /admin/publication-candidates                                                      controllers.PublicationCandidateController.listCandidates(page: Int ?= 1, pageSize: Int ?= 20)
POST          /admin/publication-candidates/:id/accept                                           controllers.PublicationCandidateController.accept(id: Int)
POST          /admin/publication-candidates/:id/reject                                           controllers.PublicationCandidateController.reject(id: Int)

# Curator Tools (requires TreeCurator or Admin role)
GET           /curator                                                                           controllers.CuratorController.dashboard

# Curator - Haplogroups
GET           /curator/haplogroups                                                               controllers.CuratorController.listHaplogroups(query: Option[String], hgType: Option[String], page: Int ?= 1, pageSize: Int ?= 20)
GET           /curator/haplogroups/fragment                                                      controllers.CuratorController.haplogroupsFragment(query: Option[String], hgType: Option[String], page: Int ?= 1, pageSize: Int ?= 20)
GET           /curator/haplogroups/search.json                                                   controllers.CuratorController.searchHaplogroupsJson(query: Option[String], hgType: Option[String])
GET           /curator/haplogroups/new                                                           controllers.CuratorController.createHaplogroupForm
POST          /curator/haplogroups                                                               controllers.CuratorController.createHaplogroup
GET           /curator/haplogroups/:id/panel                                                     controllers.CuratorController.haplogroupDetailPanel(id: Int)
GET           /curator/haplogroups/:id/edit                                                      controllers.CuratorController.editHaplogroupForm(id: Int)
POST          /curator/haplogroups/:id                                                           controllers.CuratorController.updateHaplogroup(id: Int)
DELETE        /curator/haplogroups/:id                                                           controllers.CuratorController.deleteHaplogroup(id: Int)

# Curator - Haplogroup Tree Restructuring
GET           /curator/haplogroups/:id/split                                                      controllers.CuratorController.splitBranchForm(id: Int)
POST          /curator/haplogroups/:id/split                                                      controllers.CuratorController.splitBranch(id: Int)
GET           /curator/haplogroups/:id/merge                                                      controllers.CuratorController.mergeConfirmForm(id: Int)
POST          /curator/haplogroups/:id/merge                                                      controllers.CuratorController.mergeIntoParent(id: Int)

# Curator - Haplogroup-Variant Associations
GET           /curator/haplogroups/:id/variants/search                                           controllers.CuratorController.searchVariantsForHaplogroup(id: Int, q: Option[String])
POST          /curator/haplogroups/:hgId/variant-groups/:groupKey                                controllers.CuratorController.addVariantGroupToHaplogroup(hgId: Int, groupKey: String)
DELETE        /curator/haplogroups/:hgId/variant-groups/:groupKey                                controllers.CuratorController.removeVariantGroupFromHaplogroup(hgId: Int, groupKey: String)
GET           /curator/haplogroup-variants/:hvId/history                                         controllers.CuratorController.haplogroupVariantHistory(hvId: Int)

# Curator - Variants
GET           /curator/variants                                                                  controllers.CuratorController.listVariants(query: Option[String], page: Int ?= 1, pageSize: Int ?= 20)
GET           /curator/variants/fragment                                                         controllers.CuratorController.variantsFragment(query: Option[String], page: Int ?= 1, pageSize: Int ?= 20)
GET           /curator/variants/new                                                              controllers.CuratorController.createVariantForm
POST          /curator/variants                                                                  controllers.CuratorController.createVariant
GET           /curator/variants/:id/panel                                                        controllers.CuratorController.variantDetailPanel(id: Int)
GET           /curator/variants/:id/edit                                                         controllers.CuratorController.editVariantForm(id: Int)
POST          /curator/variants/:id                                                              controllers.CuratorController.updateVariant(id: Int)
DELETE        /curator/variants/:id                                                              controllers.CuratorController.deleteVariant(id: Int)
GET           /curator/variants/group/:groupKey/edit                                             controllers.CuratorController.editVariantGroupForm(groupKey: String)
POST          /curator/variants/group/:groupKey                                                  controllers.CuratorController.updateVariantGroup(groupKey: String)

# Curator - Audit
GET           /curator/audit/:entityType/:entityId                                               controllers.CuratorController.auditHistory(entityType: String, entityId: Int)

# =============================================
# Curator - Genome Regions (session auth + permissions)
# =============================================
# Genome Regions
GET           /curator/genome-regions                                                            controllers.GenomeRegionsCuratorController.listRegions(build: Option[String], page: Int ?= 1, pageSize: Int ?= 25)
GET           /curator/genome-regions/fragment                                                   controllers.GenomeRegionsCuratorController.regionsFragment(build: Option[String], page: Int ?= 1, pageSize: Int ?= 25)
GET           /curator/genome-regions/:id/detail                                                 controllers.GenomeRegionsCuratorController.regionDetailPanel(id: Int)
GET           /curator/genome-regions/new                                                        controllers.GenomeRegionsCuratorController.createRegionForm
POST          /curator/genome-regions                                                            controllers.GenomeRegionsCuratorController.createRegion
GET           /curator/genome-regions/:id/edit                                                   controllers.GenomeRegionsCuratorController.editRegionForm(id: Int)
POST          /curator/genome-regions/:id                                                        controllers.GenomeRegionsCuratorController.updateRegion(id: Int)
DELETE        /curator/genome-regions/:id                                                        controllers.GenomeRegionsCuratorController.deleteRegion(id: Int)

# Cytobands
GET           /curator/cytobands                                                                 controllers.GenomeRegionsCuratorController.listCytobands(build: Option[String], page: Int ?= 1, pageSize: Int ?= 25)
GET           /curator/cytobands/fragment                                                        controllers.GenomeRegionsCuratorController.cytobandsFragment(build: Option[String], page: Int ?= 1, pageSize: Int ?= 25)
GET           /curator/cytobands/:id/detail                                                      controllers.GenomeRegionsCuratorController.cytobandDetailPanel(id: Int)
GET           /curator/cytobands/new                                                             controllers.GenomeRegionsCuratorController.createCytobandForm
POST          /curator/cytobands                                                                 controllers.GenomeRegionsCuratorController.createCytoband
GET           /curator/cytobands/:id/edit                                                        controllers.GenomeRegionsCuratorController.editCytobandForm(id: Int)
POST          /curator/cytobands/:id                                                             controllers.GenomeRegionsCuratorController.updateCytoband(id: Int)
DELETE        /curator/cytobands/:id                                                             controllers.GenomeRegionsCuratorController.deleteCytoband(id: Int)

# STR Markers
GET           /curator/str-markers                                                               controllers.GenomeRegionsCuratorController.listStrMarkers(build: Option[String], page: Int ?= 1, pageSize: Int ?= 25)
GET           /curator/str-markers/fragment                                                      controllers.GenomeRegionsCuratorController.strMarkersFragment(build: Option[String], page: Int ?= 1, pageSize: Int ?= 25)
GET           /curator/str-markers/:id/detail                                                    controllers.GenomeRegionsCuratorController.strMarkerDetailPanel(id: Int)
GET           /curator/str-markers/new                                                           controllers.GenomeRegionsCuratorController.createStrMarkerForm
POST          /curator/str-markers                                                               controllers.GenomeRegionsCuratorController.createStrMarker
GET           /curator/str-markers/:id/edit                                                      controllers.GenomeRegionsCuratorController.editStrMarkerForm(id: Int)
POST          /curator/str-markers/:id                                                           controllers.GenomeRegionsCuratorController.updateStrMarker(id: Int)
DELETE        /curator/str-markers/:id                                                           controllers.GenomeRegionsCuratorController.deleteStrMarker(id: Int)

# --- API Routes (Handled by Tapir, including Swagger UI) ---
POST          /api/registerPDS                                                                   controllers.PDSRegistrationController.registerPDS()

# Delegate all requests starting with /api to the Tapir-based ApiRouter
->            /api                                                                               controllers.ApiRouter

# Map static resources from the /public folder to the /assets URL path
GET           /assets/*file                                                                      controllers.Assets.versioned(path="/public", file: Asset)
->            /webjars                                                                           webjars.Routes