@import models.domain.genomics.VariantGroup
@(haplogroupId: Int, haplogroupName: String, query: Option[String], variantGroups: Seq[VariantGroup])(implicit request: RequestHeader)

<div class="mb-3">
    <label for="variantQuery" class="form-label">Search for variant by rsId, common name, or position</label>
    <input type="text"
           class="form-control"
           id="variantQuery"
           name="q"
           value="@query.getOrElse("")"
           placeholder="e.g., rs9786184, M269, chrY:22125503"
           hx-get="@controllers.routes.CuratorController.searchVariantsForHaplogroup(haplogroupId, None)"
           hx-trigger="input changed delay:300ms"
           hx-target="#variant-search-content"
           hx-include="this"
           autocomplete="off">
    <div class="form-text">Enter rsId (rs...) or common name to search. All reference builds will be added automatically.</div>
</div>

@if(query.exists(_.nonEmpty)) {
    @if(variantGroups.isEmpty) {
        <div class="alert alert-info">
            No matching variants found that aren't already associated with @haplogroupName.
        </div>
    } else {
        <div class="list-group">
            @for(group <- variantGroups.take(10)) {
                <div class="list-group-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <strong>@group.displayName</strong>
                            @group.rsId.filter(_ != group.displayName).map { rs =>
                                <span class="text-muted">(@rs)</span>
                            }
                            <span class="badge bg-secondary ms-1">@group.buildCount build@if(group.buildCount != 1){s}</span>
                        </div>
                        <button type="button"
                                class="btn btn-success btn-sm"
                                hx-post="@controllers.routes.CuratorController.addVariantGroupToHaplogroup(haplogroupId, group.groupKey)"
                                hx-target="#variants-panel"
                                hx-on::after-request="bootstrap.Modal.getInstance(document.getElementById('variantSearchModal')).hide()">
                            <i class="bi bi-plus"></i> Add All
                        </button>
                    </div>
                    <div class="mt-2 ps-2">
                        @for(vwc <- group.variantsSorted) {
                            <div class="text-muted small">
                                <span class="badge bg-info me-1" style="min-width: 55px;">@vwc.shortReferenceGenome</span>
                                <code>@vwc.formattedPosition</code>
                                <span class="ms-1">@vwc.variant.referenceAllele&rarr;@vwc.variant.alternateAllele</span>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
        @if(variantGroups.size > 10) {
            <div class="text-muted small mt-2">
                Showing first 10 of @variantGroups.size results. Refine your search for more specific results.
            </div>
        }
    }
} else {
    <div class="text-muted text-center py-3">
        Start typing to search for variants...
    </div>
}
