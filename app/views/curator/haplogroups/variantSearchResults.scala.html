@import models.domain.genomics.VariantWithContig
@(haplogroupId: Int, haplogroupName: String, query: Option[String], variants: Seq[VariantWithContig])(implicit request: RequestHeader)

<div class="mb-3">
    <label for="variantQuery" class="form-label">Search for variant by rsId, common name, or position</label>
    <input type="text"
           class="form-control"
           id="variantQuery"
           name="q"
           value="@query.getOrElse("")"
           placeholder="e.g., rs9786184, M269, chrY:22125503"
           hx-get="@controllers.routes.CuratorController.searchVariantsForHaplogroup(haplogroupId, None)"
           hx-trigger="input changed delay:300ms"
           hx-target="#variant-search-content"
           hx-include="this"
           autocomplete="off">
    <div class="form-text">Enter rsId (rs...), common name, or position (chr:pos) to search</div>
</div>

@if(query.exists(_.nonEmpty)) {
    @if(variants.isEmpty) {
        <div class="alert alert-info">
            No matching variants found that aren't already associated with @haplogroupName.
        </div>
    } else {
        <div class="list-group">
            @for(vwc <- variants.take(10)) {
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>@vwc.variant.rsId.orElse(vwc.variant.commonName).getOrElse(s"ID: ${vwc.variant.variantId.get}")</strong>
                        @vwc.variant.commonName.filter(_ => vwc.variant.rsId.isDefined).map { name =>
                            <span class="text-muted">(@name)</span>
                        }
                        <br>
                        <code class="small">@vwc.formattedPosition</code>
                        <span class="badge bg-info ms-1">@vwc.shortReferenceGenome</span>
                        <span class="badge bg-secondary ms-1">@vwc.variant.referenceAllele/@vwc.variant.alternateAllele</span>
                    </div>
                    <button type="button"
                            class="btn btn-success btn-sm"
                            hx-post="@controllers.routes.CuratorController.addVariantToHaplogroup(haplogroupId, vwc.variant.variantId.get)"
                            hx-target="#variants-panel"
                            hx-on::after-request="bootstrap.Modal.getInstance(document.getElementById('variantSearchModal')).hide()">
                        <i class="bi bi-plus"></i> Add
                    </button>
                </div>
            }
        </div>
        @if(variants.size > 10) {
            <div class="text-muted small mt-2">
                Showing first 10 of @variants.size results. Refine your search for more specific results.
            </div>
        }
    }
} else {
    <div class="text-muted text-center py-3">
        Start typing to search for variants...
    </div>
}
